<!DOCTYPE html>
<html>
  <head>
    <!-- download jQuery from Google CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- download Google Maps API -->
    <script
      async
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBXpMDT8Snwtmb8NsTM7fi3QT00U2N5KMg"
    ></script>
    <script type="text/javascript">
      function runjQuery() {
        //get inputs: address and distance
        let inputAdress = $("#adressTxtBx").val();
        let inputDistance = $("#distanceList").val();
        console.log(inputAdress);
        console.log(inputDistance);

        //Valitation address and distance
        if (inputAdress != "" && inputDistance != "") {
          //get address' coordinates (latitude, longitude)
          //use Google's Geocorder()
          const geocoder = new google.maps.Geocoder();
          geocoder.geocode(
            { address: inputAdress },
            function (results, status) {
              if (status == google.maps.GeocoderStatus.OK) {
                let coordinates = results[0].geometry.location;
                let lati = coordinates.lat();
                let long = coordinates.lng();
                console.log(lati);
                console.log(long);
                // $.ajax({
                //   //setup parameters
                //   type: "GET",
                //   url: "Hmk8.php",
                //   data:
                //     "latKey=" +
                //     lati +
                //     "&longKey=" +
                //     long +
                //     "&distanceKey=" +
                //     inputDistance,
                //   dataType: "json",
                //   success: function (serverdata) {
                //     $("#showmap").html(serverdata);
                //     //selecting values from response Object
                //     data = serverdata;
                //     console.log(data);
                //   },
                // });
                var data = [];
                $.ajax({
                  type: "POST",
                  url: "Hmk8.php",
                  data: {
                    lati: lati,
                    long: long,
                    inputDistance: inputDistance,
                  },
                  cache: false,
                  success: function (html) {
                    data = $.parseJSON(html);
                    console.log(data);
                  },
                  error: function (xhr, status, error) {
                    console.error(xhr);
                  },
                });
              } else {
                alert("user address not found");
              }
            }
          );
        } else {
          alert("Please enter a valid address and a valid distance");
          //set the focus to the text box
          $("#adressTxtBx").focus();
        }
      }
    </script>
  </head>
  <body>
    <h2>CUNY Colleges Near an Address</h2>
    <p></p>
    Address:
    <input
      type="text"
      id="adressTxtBx"
      autofocus
      size="50"
      autocomplete="street-address"
    />
    &nbsp;&nbsp;&nbsp; Minimum Distance (Miles):
    <select id="distanceList" onchange="runjQuery()">
      <option value="">Select a Distance</option>
      <option value="5">5 miles</option>
      <option value="10">10 miles</option>
      <option value="15">15 miles</option>
      <option value="20">20 miles</option>
      <option value="50">50 miles</option>
    </select>
    <p id="showmap"></p>
    <div id="showmaps" style="height: 600px; width: 100%">
      name: <span id="name"></span>
    </div>
  </body>
</html>
